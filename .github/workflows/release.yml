name: Build & Release

on:
  push:
    tags:
      - 'v*'

jobs:
  build-release:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Setup Java
        uses: actions/setup-java@v3
        with:
          java-version: '17'
          distribution: 'temurin'

      - name: Setup Flutter
        uses: subosito/flutter-action@v2
        with:
          flutter-version: '3.24.0'
          channel: 'stable'

      - name: Get Flutter dependencies
        run: flutter pub get

      - name: Build APK
        run: flutter build apk --release

      - name: Build AAB
        run: flutter build appbundle --release

      - name: Get version
        id: version
        run: echo "VERSION=${GITHUB_REF#refs/tags/}" >> $GITHUB_OUTPUT

      - name: Create Release
        uses: softprops/action-gh-release@v1
        with:
          files: |
            build/app/outputs/flutter-apk/app-release.apk
            build/app/outputs/bundle/release/app-release.aab
          body: |
            # Ø§Ù„Ø¯ÙŠÙˆØ§Ù† Ø§Ù„ÙŠÙˆÙ†Ø§Ù†ÙŠ - Greek Diwan ${{ steps.version.outputs.VERSION }}
            
            ## ğŸ“± APK (Ù„Ù„ØªØ«Ø¨ÙŠØª Ø§Ù„Ù…Ø¨Ø§Ø´Ø±)
            - app-release.apk
            
            ## ğŸ“¦ AAB (Ù„Ù€ Google Play)
            - app-release.aab
            
            ## âœ¨ Features
            - ğŸ›ï¸ Ø§Ù„Ù…ÙˆØ§Ù‚Ø¹ Ø§Ù„Ø£Ø«Ø±ÙŠØ©
            - ğŸ›ï¸ Ø§Ù„Ø¢Ù„Ù‡Ø© Ø§Ù„ÙŠÙˆÙ†Ø§Ù†ÙŠØ©
            - ğŸ“– Ø§Ù„Ø£Ø³Ø§Ø·ÙŠØ±
            - ğŸ½ï¸ Ø§Ù„Ø·Ø¹Ø§Ù… Ø§Ù„ÙŠÙˆÙ†Ø§Ù†ÙŠ
            - ğŸ¨ ØªØµÙ…ÙŠÙ… Ø­Ø¯ÙŠØ«
            - ğŸŒ Ø¯Ø¹Ù… Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
